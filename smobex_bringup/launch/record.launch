<?xml version="1.0"?>
<launch>

    <arg name="octo_resolution" default="0.01"/>
    <arg name="robot_ip" default="192.168.0.230"/>
    <arg name="online" default="true"/>

    <!-- Initiating the OpenNI2 constelation -->
    <include file="$(find openni2_launch)/launch/openni2.launch">
        <arg name="publish_tf" value="false"/>
    </include>
    <!--  -->

    <!-- Initializing robot and camera calibrated -->
    <include file="$(find smobex_calibration)/launch/calibrated.launch">
        <arg name="robot_ip" value="$(arg robot_ip)" />
        <arg name="online" value="$(arg online)"/>
    </include>
    <!--  -->

    <!-- Initializing OctoMap Server with the right params -->
    <node pkg="octomap_server" type="octomap_server_node" name="octomap_server_node">

        <remap from="cloud_in" to="camera/depth_registered/points" />
        <param name="publish_free_space" value="true"/>

        <param name="~frame_id" value="base_link" />
        <param name="~resolution" value="$arg(octo_resolution)"/>

    </node>
    <!--  -->

    <!-- Accumulated Cloud -->
    <node pkg="world_model_consistency_check" type="accumulatepointcloud2file" name="accumulatedpointcloud2file" output="screen">

        <remap from="input" to="camera/depth_registered/points"/>
        <param name="~filename" value="/home/joao/auto_save.pcd" type="str"/>
        <remap from="map" to="base_link"/>

    </node>

    <!-- Rviz for visualization -->
    <node pkg="rviz" type="rviz" name="rviz" args="--display-config $(find smobex_bringup)/config/record_mode.rviz" required="true"/>

</launch>